## 1. Obtain genetic correlation
## sample=UKB_15K p=0.001 rho=0.8 i=1  EUR_EAS: 0.90 EUR_AFR: 0.89
## sample=UKB_20K p=0.001 rho=0.8 i=1  EUR_EAS: 0.76 EUR_AFR: 0.74
## sample=UKB_25K p=0.001 rho=0.8 i=1  EUR_EAS: 0.80 EUR_AFR: 0.81
## sample=UKB_80K p=0.001 rho=0.8 i=1  EUR_EAS: 0.80 EUR_AFR: 0.81
## sample=UKB_85K p=0.001 rho=0.8 i=1  EUR_EAS: 0.80 EUR_AFR: 0.82
## sample=UKB_90K p=0.001 rho=0.8 i=1  EUR_EAS: 0.79 EUR_AFR: 0.83

## sample=UKB_15K p=0.01  rho=0.8 i=1  EUR_EAS: 0.76 EUR_AFR: 0.81
## sample=UKB_20K p=0.01  rho=0.8 i=1  EUR_EAS: 0.80 EUR_AFR: 0.85
## sample=UKB_25K p=0.01  rho=0.8 i=1  EUR_EAS: 0.77 EUR_AFR: 0.80
## sample=UKB_80K p=0.01  rho=0.8 i=1  EUR_EAS: 0.78 EUR_AFR: 0.79
## sample=UKB_85K p=0.01  rho=0.8 i=1  EUR_EAS: 0.77 EUR_AFR: 0.79
## sample=UKB_90K p=0.01  rho=0.8 i=1  EUR_EAS: 0.79 EUR_AFR: 0.78

## sample=UKB_15K p=5e-04 rho=0.8 i=1  EUR_EAS: 0.77 EUR_AFR: 0.88
## sample=UKB_20K p=5e-04 rho=0.8 i=1  EUR_EAS: 0.87 EUR_AFR: 0.87
## sample=UKB_25K p=5e-04 rho=0.8 i=1  EUR_EAS: 0.79 EUR_AFR: 0.96
## sample=UKB_80K p=5e-04 rho=0.8 i=1  EUR_EAS: 0.79 EUR_AFR: 0.86
## sample=UKB_85K p=5e-04 rho=0.8 i=1  EUR_EAS: 0.79 EUR_AFR: 0.89
## sample=UKB_90K p=5e-04 rho=0.8 i=1  EUR_EAS: 0.82 EUR_AFR: 0.87

## sample=UKB_15K p=0.1  rho=0.8 i=1  EUR_EAS: 0.81 EUR_AFR: 0.75
## sample=UKB_20K p=0.1  rho=0.8 i=1  EUR_EAS: 0.81 EUR_AFR: 0.82
## sample=UKB_25K p=0.1  rho=0.8 i=1  EUR_EAS: 0.77 EUR_AFR: 0.80
## sample=UKB_80K p=0.1  rho=0.8 i=1  EUR_EAS: 0.84 EUR_AFR: 0.79
## sample=UKB_85K p=0.1  rho=0.8 i=1  EUR_EAS: 0.82 EUR_AFR: 0.78
## sample=UKB_90K p=0.1  rho=0.8 i=1  EUR_EAS: 0.78 EUR_AFR: 0.78




## sample=UKB_15K p=0.001 rho=0.8 i=2  EUR_EAS: 0.71 EUR_AFR: 0.66
## sample=UKB_20K p=0.001 rho=0.8 i=2  EUR_EAS: 0.71 EUR_AFR: 0.68
## sample=UKB_25K p=0.001 rho=0.8 i=2  EUR_EAS: 0.71 EUR_AFR: 0.65
## sample=UKB_80K p=0.001 rho=0.8 i=2  EUR_EAS: 0.76 EUR_AFR: 0.66
## sample=UKB_85K p=0.001 rho=0.8 i=2  EUR_EAS: 0.75 EUR_AFR: 0.69
## sample=UKB_90K p=0.001 rho=0.8 i=2  EUR_EAS: 0.72 EUR_AFR: 0.66

## sample=UKB_15K p=0.01  rho=0.8 i=2  EUR_EAS: 0.88 EUR_AFR: 0.79
## sample=UKB_20K p=0.01  rho=0.8 i=2  EUR_EAS: 0.84 EUR_AFR: 0.80
## sample=UKB_25K p=0.01  rho=0.8 i=2  EUR_EAS: 0.91 EUR_AFR: 0.77
## sample=UKB_80K p=0.01  rho=0.8 i=2  EUR_EAS: 0.82 EUR_AFR: 0.82
## sample=UKB_85K p=0.01  rho=0.8 i=2  EUR_EAS: 0.84 EUR_AFR: 0.81
## sample=UKB_90K p=0.01  rho=0.8 i=2  EUR_EAS: 0.85 EUR_AFR: 0.82

## sample=UKB_15K p=5e-04 rho=0.8 i=2  EUR_EAS: 0.85 EUR_AFR: 0.95
## sample=UKB_20K p=5e-04 rho=0.8 i=2  EUR_EAS: 0.84 EUR_AFR: 0.78
## sample=UKB_25K p=5e-04 rho=0.8 i=2  EUR_EAS: 0.78 EUR_AFR: 0.79
## sample=UKB_80K p=5e-04 rho=0.8 i=2  EUR_EAS: 0.80 EUR_AFR: 0.81
## sample=UKB_85K p=5e-04 rho=0.8 i=2  EUR_EAS: 0.84 EUR_AFR: 0.79
## sample=UKB_90K p=5e-04 rho=0.8 i=2  EUR_EAS: 0.81 EUR_AFR: 0.79

## sample=UKB_15K p=0.1  rho=0.8 i=2  EUR_EAS: 0.80 EUR_AFR: 0.88
## sample=UKB_20K p=0.1  rho=0.8 i=2  EUR_EAS: 0.82 EUR_AFR: 0.89
## sample=UKB_25K p=0.1  rho=0.8 i=2  EUR_EAS: 0.85 EUR_AFR: 0.81
## sample=UKB_80K p=0.1  rho=0.8 i=2  EUR_EAS: 0.83 EUR_AFR: 0.77
## sample=UKB_85K p=0.1  rho=0.8 i=2  EUR_EAS: 0.84 EUR_AFR: 0.77
## sample=UKB_90K p=0.1  rho=0.8 i=2  EUR_EAS: 0.84 EUR_AFR: 0.76




## sample=UKB_15K p=0.001 rho=0.8 i=3  EUR_EAS: 0.80 EUR_AFR: 0.80
## sample=UKB_20K p=0.001 rho=0.8 i=3  EUR_EAS: 0.81 EUR_AFR: 0.81
## sample=UKB_25K p=0.001 rho=0.8 i=3  EUR_EAS: 0.77 EUR_AFR: 0.69
## sample=UKB_80K p=0.001 rho=0.8 i=3  EUR_EAS: 0.84 EUR_AFR: 0.79
## sample=UKB_85K p=0.001 rho=0.8 i=3  EUR_EAS: 0.85 EUR_AFR: 0.81
## sample=UKB_90K p=0.001 rho=0.8 i=3  EUR_EAS: 0.83 EUR_AFR: 0.78

## sample=UKB_15K p=0.01  rho=0.8 i=3  EUR_EAS: 0.86 EUR_AFR: 0.82
## sample=UKB_20K p=0.01  rho=0.8 i=3  EUR_EAS: 0.91 EUR_AFR: 0.85
## sample=UKB_25K p=0.01  rho=0.8 i=3  EUR_EAS: 0.84 EUR_AFR: 0.80
## sample=UKB_80K p=0.01  rho=0.8 i=3  EUR_EAS: 0.85 EUR_AFR: 0.82
## sample=UKB_85K p=0.01  rho=0.8 i=3  EUR_EAS: 0.84 EUR_AFR: 0.83
## sample=UKB_90K p=0.01  rho=0.8 i=3  EUR_EAS: 0.93 EUR_AFR: 0.76

## sample=UKB_15K p=5e-04 rho=0.8 i=3  EUR_EAS: 0.93 EUR_AFR: 0.76
## sample=UKB_20K p=5e-04 rho=0.8 i=3  EUR_EAS: 0.88 EUR_AFR: 0.76
## sample=UKB_25K p=5e-04 rho=0.8 i=3  EUR_EAS: 0.84 EUR_AFR: 0.67
## sample=UKB_80K p=5e-04 rho=0.8 i=3  EUR_EAS: 0.87 EUR_AFR: 0.71
## sample=UKB_85K p=5e-04 rho=0.8 i=3  EUR_EAS: 0.84 EUR_AFR: 0.69
## sample=UKB_90K p=5e-04 rho=0.8 i=3  EUR_EAS: 0.84 EUR_AFR: 0.73

## sample=UKB_15K p=0.1  rho=0.8 i=3  EUR_EAS: 0.79 EUR_AFR: 0.74
## sample=UKB_20K p=0.1  rho=0.8 i=3  EUR_EAS: 0.80 EUR_AFR: 0.73
## sample=UKB_25K p=0.1  rho=0.8 i=3  EUR_EAS: 0.86 EUR_AFR: 0.74
## sample=UKB_80K p=0.1  rho=0.8 i=3  EUR_EAS: 0.83 EUR_AFR: 0.74
## sample=UKB_85K p=0.1  rho=0.8 i=3  EUR_EAS: 0.82 EUR_AFR: 0.76
## sample=UKB_90K p=0.1  rho=0.8 i=3  EUR_EAS: 0.81 EUR_AFR: 0.75




## sample=UKB_15K p=0.001 rho=0.8 i=4  EUR_EAS: 0.79 EUR_AFR: 0.79
## sample=UKB_20K p=0.001 rho=0.8 i=4  EUR_EAS: 0.85 EUR_AFR: 0.72
## sample=UKB_25K p=0.001 rho=0.8 i=4  EUR_EAS: 0.85 EUR_AFR: 0.77
## sample=UKB_80K p=0.001 rho=0.8 i=4  EUR_EAS: 0.82 EUR_AFR: 0.66
## sample=UKB_85K p=0.001 rho=0.8 i=4  EUR_EAS: 0.79 EUR_AFR: 0.73
## sample=UKB_90K p=0.001 rho=0.8 i=4  EUR_EAS: 0.83 EUR_AFR: 0.71

## sample=UKB_15K p=0.01  rho=0.8 i=4  EUR_EAS: 0.75 EUR_AFR: 0.79
## sample=UKB_20K p=0.01  rho=0.8 i=4  EUR_EAS: 0.73 EUR_AFR: 0.81
## sample=UKB_25K p=0.01  rho=0.8 i=4  EUR_EAS: 0.79 EUR_AFR: 0.77
## sample=UKB_80K p=0.01  rho=0.8 i=4  EUR_EAS: 0.82 EUR_AFR: 0.83
## sample=UKB_85K p=0.01  rho=0.8 i=4  EUR_EAS: 0.82 EUR_AFR: 0.78
## sample=UKB_90K p=0.01  rho=0.8 i=4  EUR_EAS: 0.84 EUR_AFR: 0.79

## sample=UKB_15K p=5e-04 rho=0.8 i=4  EUR_EAS: 0.64 EUR_AFR: 0.75
## sample=UKB_20K p=5e-04 rho=0.8 i=4  EUR_EAS: 0.64 EUR_AFR: 0.77
## sample=UKB_25K p=5e-04 rho=0.8 i=4  EUR_EAS: 0.65 EUR_AFR: 0.71
## sample=UKB_80K p=5e-04 rho=0.8 i=4  EUR_EAS: 0.70 EUR_AFR: 0.72
## sample=UKB_85K p=5e-04 rho=0.8 i=4  EUR_EAS: 0.69 EUR_AFR: 0.72
## sample=UKB_90K p=5e-04 rho=0.8 i=4  EUR_EAS: 0.70 EUR_AFR: 0.73

## sample=UKB_15K p=0.1  rho=0.8 i=4  EUR_EAS: 0.81 EUR_AFR: 0.72
## sample=UKB_20K p=0.1  rho=0.8 i=4  EUR_EAS: 0.88 EUR_AFR: 0.72
## sample=UKB_25K p=0.1  rho=0.8 i=4  EUR_EAS: 0.78 EUR_AFR: 0.82
## sample=UKB_80K p=0.1  rho=0.8 i=4  EUR_EAS: 0.83 EUR_AFR: 0.79
## sample=UKB_85K p=0.1  rho=0.8 i=4  EUR_EAS: 0.85 EUR_AFR: 0.78
## sample=UKB_90K p=0.1  rho=0.8 i=4  EUR_EAS: 0.79 EUR_AFR: 0.78




## sample=UKB_15K p=0.001 rho=0.8 i=5  EUR_EAS: 0.85 EUR_AFR: 0.73
## sample=UKB_20K p=0.001 rho=0.8 i=5  EUR_EAS: 0.76 EUR_AFR: 0.73
## sample=UKB_25K p=0.001 rho=0.8 i=5  EUR_EAS: 0.78 EUR_AFR: 0.75
## sample=UKB_80K p=0.001 rho=0.8 i=5  EUR_EAS: 0.79 EUR_AFR: 0.73
## sample=UKB_85K p=0.001 rho=0.8 i=5  EUR_EAS: 0.80 EUR_AFR: 0.73
## sample=UKB_90K p=0.001 rho=0.8 i=5  EUR_EAS: 0.80 EUR_AFR: 0.72

## sample=UKB_15K p=0.01  rho=0.8 i=5  EUR_EAS: 0.77 EUR_AFR: 0.66
## sample=UKB_20K p=0.01  rho=0.8 i=5  EUR_EAS: 0.81 EUR_AFR: 0.67
## sample=UKB_25K p=0.01  rho=0.8 i=5  EUR_EAS: 0.82 EUR_AFR: 0.71
## sample=UKB_80K p=0.01  rho=0.8 i=5  EUR_EAS: 0.79 EUR_AFR: 0.71
## sample=UKB_85K p=0.01  rho=0.8 i=5  EUR_EAS: 0.79 EUR_AFR: 0.74
## sample=UKB_90K p=0.01  rho=0.8 i=5  EUR_EAS: 0.75 EUR_AFR: 0.72

## sample=UKB_15K p=5e-04 rho=0.8 i=5  EUR_EAS: 0.84 EUR_AFR: 0.94
## sample=UKB_20K p=5e-04 rho=0.8 i=5  EUR_EAS: 0.89 EUR_AFR: 0.83
## sample=UKB_25K p=5e-04 rho=0.8 i=5  EUR_EAS: 0.87 EUR_AFR: 0.92
## sample=UKB_80K p=5e-04 rho=0.8 i=5  EUR_EAS: 0.85 EUR_AFR: 0.89
## sample=UKB_85K p=5e-04 rho=0.8 i=5  EUR_EAS: 0.84 EUR_AFR: 0.88
## sample=UKB_90K p=5e-04 rho=0.8 i=5  EUR_EAS: 0.83 EUR_AFR: 0.88

## sample=UKB_15K p=0.1  rho=0.8 i=5  EUR_EAS: 0.69 EUR_AFR: 0.84
## sample=UKB_20K p=0.1  rho=0.8 i=5  EUR_EAS: 0.73 EUR_AFR: 0.72
## sample=UKB_25K p=0.1  rho=0.8 i=5  EUR_EAS: 0.81 EUR_AFR: 0.76
## sample=UKB_80K p=0.1  rho=0.8 i=5  EUR_EAS: 0.82 EUR_AFR: 0.78
## sample=UKB_85K p=0.1  rho=0.8 i=5  EUR_EAS: 0.80 EUR_AFR: 0.78
## sample=UKB_90K p=0.1  rho=0.8 i=5  EUR_EAS: 0.79 EUR_AFR: 0.78




## small sample size
module load miniconda
conda activate popcorn

cd /gpfs/gibbs/pi/zhao/lx94/JointPRS/method/Popcorn

rho=0.8 

pop1=EUR

for i in {1..5}; do
for p in 0.001 0.01 5e-04 0.1; do
for sample in UKB_15K UKB_20K UKB_25K UKB_80K UKB_85K UKB_90K; do
for pop2 in EAS AFR; do
if [[ "${sample}" == "UKB_15K" ]]; then
popcorn fit -v 0 \
--cfile ./ref/${pop1}_${pop2}_all_gen_eff.cscore \
--gen_effect \
--sfile1 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop1}/discover/popcorn/${pop1}_sim${i}_p${p}_rho${rho}_UKB_popcorn_real.txt \
--sfile2 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop2}/discover/popcorn/${pop2}_sim${i}_p${p}_rho${rho}_15K_popcorn_real.txt \
/gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_15K_popcorn_real_corr.txt
fi

if [[ "${sample}" == "UKB_20K" ]]; then
popcorn fit -v 0 \
--cfile ./ref/${pop1}_${pop2}_all_gen_eff.cscore \
--gen_effect \
--sfile1 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop1}/discover/popcorn/${pop1}_sim${i}_p${p}_rho${rho}_UKB_popcorn_real.txt \
--sfile2 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop2}/discover_validate/popcorn/${pop2}_sim${i}_p${p}_rho${rho}_20K_popcorn_real.txt \
/gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_20K_popcorn_real_corr.txt
fi

if [[ "${sample}" == "UKB_25K" ]]; then
popcorn fit -v 0 \
--cfile ./ref/${pop1}_${pop2}_all_gen_eff.cscore \
--gen_effect \
--sfile1 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop1}/discover/popcorn/${pop1}_sim${i}_p${p}_rho${rho}_UKB_popcorn_real.txt \
--sfile2 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop2}/discover_validate/popcorn/${pop2}_sim${i}_p${p}_rho${rho}_25K_popcorn_real.txt \
/gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_25K_popcorn_real_corr.txt
fi

if [[ "${sample}" == "UKB_80K" ]]; then
popcorn fit -v 0 \
--cfile ./ref/${pop1}_${pop2}_all_gen_eff.cscore \
--gen_effect \
--sfile1 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop1}/discover/popcorn/${pop1}_sim${i}_p${p}_rho${rho}_UKB_popcorn_real.txt \
--sfile2 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop2}/discover/popcorn/${pop2}_sim${i}_p${p}_rho${rho}_80K_popcorn_real.txt \
/gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_80K_popcorn_real_corr.txt
fi

if [[ "${sample}" == "UKB_85K" ]]; then
popcorn fit -v 0 \
--cfile ./ref/${pop1}_${pop2}_all_gen_eff.cscore \
--gen_effect \
--sfile1 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop1}/discover/popcorn/${pop1}_sim${i}_p${p}_rho${rho}_UKB_popcorn_real.txt \
--sfile2 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop2}/discover_validate/popcorn/${pop2}_sim${i}_p${p}_rho${rho}_85K_popcorn_real.txt \
/gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_85K_popcorn_real_corr.txt
fi

if [[ "${sample}" == "UKB_90K" ]]; then
popcorn fit -v 0 \
--cfile ./ref/${pop1}_${pop2}_all_gen_eff.cscore \
--gen_effect \
--sfile1 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop1}/discover/popcorn/${pop1}_sim${i}_p${p}_rho${rho}_UKB_popcorn_real.txt \
--sfile2 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop2}/discover_validate/popcorn/${pop2}_sim${i}_p${p}_rho${rho}_90K_popcorn_real.txt \
/gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_90K_popcorn_real_corr.txt
fi
done
done
done
done

## 2. Check genetic correlation
i=5 # 1-5
rho=0.8 

pop1=EUR

for p in 0.001 0.01 5e-04 0.1; do
for sample in UKB_15K UKB_20K UKB_25K UKB_80K UKB_85K UKB_90K; do
for pop2 in EAS AFR; do
if [[ "${sample}" == "UKB_15K" ]]; then
echo ${sample}_sim${i}_p${p}_rho${rho}:${pop1}_${pop2}
cat /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_15K_popcorn_real_corr.txt
fi

if [[ "${sample}" == "UKB_20K" ]]; then
echo ${sample}_sim${i}_p${p}_rho${rho}:${pop1}_${pop2}
cat /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_20K_popcorn_real_corr.txt
fi

if [[ "${sample}" == "UKB_25K" ]]; then
echo ${sample}_sim${i}_p${p}_rho${rho}:${pop1}_${pop2}
cat /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_25K_popcorn_real_corr.txt
fi

if [[ "${sample}" == "UKB_80K" ]]; then
echo ${sample}_sim${i}_p${p}_rho${rho}:${pop1}_${pop2}
cat /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_80K_popcorn_real_corr.txt
fi

if [[ "${sample}" == "UKB_85K" ]]; then
echo ${sample}_sim${i}_p${p}_rho${rho}:${pop1}_${pop2}
cat /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_85K_popcorn_real_corr.txt
fi

if [[ "${sample}" == "UKB_90K" ]]; then
echo ${sample}_sim${i}_p${p}_rho${rho}:${pop1}_${pop2}
cat /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_90K_popcorn_real_corr.txt
fi

done
done
done