## 1. Obtain genetic correlation
## sample=UKB_15K p=5e-04 rho=0.8 i=1  EUR_EAS: 0.77 EUR_AFR: 0.88 EUR_SAS: 0.75 EUR_AMR: 0.86 
## sample=15K_15K p=5e-04 rho=0.8 i=1  EAS_AFR: 0.70 EAS_SAS: 0.65 EAS_AMR: 0.99
## sample=15K_15K p=5e-04 rho=0.8 i=1  AFR_SAS: 0.91 AFR_AMR: 0.99
## sample=15K_15K p=5e-04 rho=0.8 i=1  SAS_AMR: 0.86

## sample=UKB_15K p=0.1   rho=0.8 i=1  EUR_EAS: 0.81 EUR_AFR: 0.75 EUR_SAS: 0.80 EUR_AMR: 0.73
## sample=15K_15K p=0.1   rho=0.8 i=1  EAS_AFR: 0.65 EAS_SAS: 0.88 EAS_AMR: 0.86
## sample=15K_15K p=0.1   rho=0.8 i=1  AFR_SAS: 0.90 AFR_AMR: 0.57
## sample=15K_15K p=0.1   rho=0.8 i=1  SAS_AMR: 0.86

## sample=UKB_15K p=5e-04 rho=0.8 i=2  EUR_EAS: 0.85 EUR_AFR: 0.95 EUR_SAS: 0.87 EUR_AMR: 0.85
## sample=15K_15K p=5e-04 rho=0.8 i=2  EAS_AFR: 0.99 EAS_SAS: 0.90 EAS_AMR: 0.95
## sample=15K_15K p=5e-04 rho=0.8 i=2  AFR_SAS: 0.99 AFR_AMR: 0.99
## sample=15K_15K p=5e-04 rho=0.8 i=2  SAS_AMR: 0.97

## sample=UKB_15K p=0.1   rho=0.8 i=2  EUR_EAS: 0.80 EUR_AFR: 0.88 EUR_SAS: 0.79 EUR_AMR: 0.85
## sample=15K_15K p=0.1   rho=0.8 i=2  EAS_AFR: 0.89 EAS_SAS: 0.83 EAS_AMR: 0.85
## sample=15K_15K p=0.1   rho=0.8 i=2  AFR_SAS: 0.98 AFR_AMR: 0.99
## sample=15K_15K p=0.1   rho=0.8 i=2  SAS_AMR: 0.80

## sample=UKB_15K p=5e-04 rho=0.8 i=3  EUR_EAS: 0.93 EUR_AFR: 0.76 EUR_SAS: 0.70 EUR_AMR: 0.76
## sample=15K_15K p=5e-04 rho=0.8 i=3  EAS_AFR: 0.99 EAS_SAS: 0.81 EAS_AMR: 0.99
## sample=15K_15K p=5e-04 rho=0.8 i=3  AFR_SAS: 0.63 AFR_AMR: 0.79
## sample=15K_15K p=5e-04 rho=0.8 i=3  SAS_AMR: 0.83

## sample=UKB_15K p=0.1   rho=0.8 i=3  EUR_EAS: 0.79 EUR_AFR: 0.74 EUR_SAS: 0.74 EUR_AMR: 0.86
## sample=15K_15K p=0.1   rho=0.8 i=3  EAS_AFR: 0.73 EAS_SAS: 0.74 EAS_AMR: 0.82
## sample=15K_15K p=0.1   rho=0.8 i=3  AFR_SAS: 0.86 AFR_AMR: 0.93
## sample=15K_15K p=0.1   rho=0.8 i=3  SAS_AMR: 0.89

## sample=UKB_15K p=5e-04 rho=0.8 i=4  EUR_EAS: 0.64 EUR_AFR: 0.75 EUR_SAS: 0.68 EUR_AMR: 0.83
## sample=15K_15K p=5e-04 rho=0.8 i=4  EAS_AFR: 0.56 EAS_SAS: 0.70 EAS_AMR: 0.84
## sample=15K_15K p=5e-04 rho=0.8 i=4  AFR_SAS: 0.90 AFR_AMR: 0.89
## sample=15K_15K p=5e-04 rho=0.8 i=4  SAS_AMR: 0.61

## sample=UKB_15K p=0.1   rho=0.8 i=4  EUR_EAS: 0.81 EUR_AFR: 0.72 EUR_SAS: 0.74 EUR_AMR: 0.88
## sample=15K_15K p=0.1   rho=0.8 i=4  EAS_AFR: 0.73 EAS_SAS: 0.72 EAS_AMR: 0.90
## sample=15K_15K p=0.1   rho=0.8 i=4  AFR_SAS: 0.73 AFR_AMR: 0.90
## sample=15K_15K p=0.1   rho=0.8 i=4  SAS_AMR: 0.98

## sample=UKB_15K p=5e-04 rho=0.8 i=5  EUR_EAS: 0.84 EUR_AFR: 0.94 EUR_SAS: 0.82 EUR_AMR: 0.83
## sample=15K_15K p=5e-04 rho=0.8 i=5  EAS_AFR: 0.99 EAS_SAS: 0.91 EAS_AMR: 0.85
## sample=15K_15K p=5e-04 rho=0.8 i=5  AFR_SAS: 0.83 AFR_AMR: 0.86
## sample=15K_15K p=5e-04 rho=0.8 i=5  SAS_AMR: 0.89

## sample=UKB_15K p=0.1   rho=0.8 i=5  EUR_EAS: 0.69 EUR_AFR: 0.84 EUR_SAS: 0.79 EUR_AMR: 0.82
## sample=15K_15K p=0.1   rho=0.8 i=5  EAS_AFR: 0.75 EAS_SAS: 0.72 EAS_AMR: 0.75
## sample=15K_15K p=0.1   rho=0.8 i=5  AFR_SAS: 0.67 AFR_AMR: 0.83
## sample=15K_15K p=0.1   rho=0.8 i=5  SAS_AMR: 0.99

## small sample size
module load miniconda
conda activate popcorn

cd /gpfs/gibbs/pi/zhao/lx94/JointPRS/method/Popcorn

rho=0.8 

pop1=SAS

for i in {1..5}; do
for p in 5e-04 0.1; do
for pop2 in AMR; do
if [[ "${pop1}" == "EUR" ]]; then
popcorn fit -v 0 \
--cfile ./ref/${pop1}_${pop2}_all_gen_eff.cscore \
--gen_effect \
--sfile1 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop1}/discover/popcorn/${pop1}_sim${i}_p${p}_rho${rho}_UKB_popcorn_real.txt \
--sfile2 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop2}/discover/popcorn/${pop2}_sim${i}_p${p}_rho${rho}_15K_popcorn_real.txt \
/gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_15K_popcorn_real_corr.txt
fi

if [[ "${pop1}" != "EUR" ]]; then
popcorn fit -v 0 \
--cfile ./ref/${pop1}_${pop2}_all_gen_eff.cscore \
--gen_effect \
--sfile1 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop1}/discover/popcorn/${pop1}_sim${i}_p${p}_rho${rho}_15K_popcorn_real.txt \
--sfile2 /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/data/sim_data/summary_data/${pop2}/discover/popcorn/${pop2}_sim${i}_p${p}_rho${rho}_15K_popcorn_real.txt \
/gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_15K_15K_popcorn_real_corr.txt
fi
done
done
done

## 2. Check genetic correlation
rho=0.8 

pop1=SAS

for i in {1..5}; do
for p in 5e-04 0.1; do
for pop2 in AMR; do
if [[ "${pop1}" == "EUR" ]]; then
echo sample=UKB_15K p=${p} rho=${rho} i=${i}:${pop1}_${pop2}
cat /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_UKB_15K_popcorn_real_corr.txt
fi

if [[ "${pop1}" != "EUR" ]]; then
echo sample=15K_15K p=${p} rho=${rho} i=${i}:${pop1}_${pop2}
cat /gpfs/gibbs/pi/zhao/lx94/JointPRS/revision/result/sim_result/popcorn/sim${i}_p${p}_rho${rho}/${pop1}_${pop2}_15K_15K_popcorn_real_corr.txt
fi
done
done
done